<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰“ç –å— - å°æ¸¸æˆé›†åˆ</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
        }

        .game-container {
            display: flex;
            gap: 30px;
            background: rgba(0,0,0,0.3);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        .game-board {
            position: relative;
        }

        .game-title {
            text-align: center;
            margin-bottom: 20px;
            font-size: 2em;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        #gameCanvas {
            border: 3px solid #fff;
            border-radius: 15px;
            background: linear-gradient(180deg, #001122 0%, #002244 100%);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            cursor: none;
        }

        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-width: 280px;
            max-width: 320px;
        }

        .info-box {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid rgba(255,255,255,0.2);
            text-align: center;
        }

        .info-box h3 {
            margin: 0 0 15px 0;
            color: #4ecdc4;
            font-size: 1.2em;
        }

        .score {
            font-size: 1.5em;
            font-weight: bold;
            color: #ff6b6b;
        }

        .level {
            font-size: 1.2em;
            color: #45b7d1;
        }

        .lives {
            font-size: 1.1em;
            color: #96ceb4;
        }

        .high-score {
            font-size: 1em;
            color: #dda0dd;
        }

        .power-ups {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
        }

        .power-up-slot {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            background: rgba(255,255,255,0.1);
        }

        .controls {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .controls h3 {
            margin: 0 0 15px 0;
            color: #4ecdc4;
            text-align: center;
        }

        .controls table {
            width: 100%;
            border-collapse: collapse;
        }

        .controls td {
            padding: 8px;
            text-align: left;
            font-size: 0.9em;
        }

        .controls td:first-child {
            font-weight: bold;
            color: #ff6b6b;
        }

        /* æ–°çš„æ§åˆ¶è¯´æ˜æ ·å¼ */
        .control-group {
            margin-bottom: 15px;
        }
        .control-group:last-child {
            margin-bottom: 0;
        }
        .control-title {
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        .control-item {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            font-size: 0.85em;
        }
        .key {
            background: linear-gradient(145deg, rgba(255,255,255,0.25), rgba(255,255,255,0.15));
            border: 1px solid rgba(255,255,255,0.4);
            border-radius: 6px;
            padding: 4px 8px;
            margin-right: 8px;
            font-weight: bold;
            color: #fff;
            min-width: 28px;
            height: 24px;
            text-align: center;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            font-size: 0.9em;
        }
        .action {
            color: rgba(255,255,255,0.9);
        }
        .power-up-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .power-up-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
        }
        .power-up-item {
            font-size: 0.8em;
            color: rgba(255,255,255,0.9);
            padding: 4px 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .game-tips {
            font-size: 0.75em;
            color: rgba(255,255,255,0.8);
            line-height: 1.4;
        }
        .game-tips div {
            margin-bottom: 4px;
        }

        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            display: none;
            z-index: 100;
            border: 3px solid #ff6b6b;
            min-width: 300px;
        }

        .game-over h2 {
            margin: 0 0 20px 0;
            color: #ff6b6b;
            font-size: 2em;
        }

        .game-over p {
            margin: 10px 0;
            font-size: 1.2em;
        }

        .restart-btn {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            margin-top: 20px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .restart-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .pause-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 10px 20px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 15px;
            transition: all 0.3s ease;
            width: 100%;
        }

        .pause-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .level-progress {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ecdc4, #ff6b6b);
            width: 0%;
            transition: width 0.3s ease;
        }

        .combo-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,215,0,0.9);
            color: #000;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.2em;
            display: none;
            animation: comboFade 2s ease-out;
        }

        @keyframes comboFade {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(1.2); }
        }

        .power-up-indicator {
            position: absolute;
            top: 60px;
            right: 20px;
            background: rgba(0,255,0,0.8);
            color: #000;
            padding: 8px 16px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 1em;
            display: none;
            animation: powerUpFade 3s ease-out;
        }

        @keyframes powerUpFade {
            0% { opacity: 1; }
            70% { opacity: 1; }
            100% { opacity: 0; }
        }

        @media (max-width: 768px) {
            .game-container {
                flex-direction: column;
                align-items: center;
                padding: 20px;
            }

            .side-panel {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-board">
            <h1 class="game-title">ğŸ¯ æ‰“ç –å—</h1>
            <canvas id="gameCanvas" width="600" height="600"></canvas>
            <div class="combo-indicator" id="comboIndicator"></div>
            <div class="power-up-indicator" id="powerUpIndicator"></div>
            <div class="game-over" id="gameOver">
                <h2 id="gameOverTitle">æ¸¸æˆç»“æŸ!</h2>
                <p>æœ€ç»ˆå¾—åˆ†: <span id="finalScore">0</span></p>
                <p>è¾¾åˆ°å…³å¡: <span id="finalLevel">1</span></p>
                <p>æ¶ˆé™¤ç –å—: <span id="finalBricks">0</span></p>
                <p>æœ€é«˜è¿å‡»: <span id="finalCombo">0</span></p>
                <button class="restart-btn" onclick="restartGame()">é‡æ–°å¼€å§‹</button>
            </div>
        </div>

        <div class="side-panel">
            <div class="info-box">
                <h3>å¾—åˆ†</h3>
                <div class="score" id="score">0</div>
                <div class="high-score">æœ€é«˜: <span id="highScore">0</span></div>
            </div>

            <div class="info-box">
                <h3>å…³å¡</h3>
                <div class="level" id="level">1</div>
                <div class="level-progress">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <div class="info-box">
                <h3>ç”Ÿå‘½å€¼</h3>
                <div class="lives" id="lives">â¤ï¸â¤ï¸â¤ï¸</div>
            </div>

            <div class="info-box">
                <h3>å½“å‰çŠ¶æ€</h3>
                <div style="font-size: 0.9em;">
                    <div>ç –å—: <span id="bricksLeft">0</span></div>
                    <div>è¿å‡»: <span id="currentCombo">0</span></div>
                    <div>çƒé€Ÿ: <span id="ballSpeed">æ­£å¸¸</span></div>
                </div>
                <button class="pause-btn" onclick="togglePause()">æš‚åœ</button>
            </div>

            <div class="info-box">
                <h3>é“å…·æ•ˆæœ</h3>
                <div class="power-ups">
                    <div class="power-up-slot" id="slot1">-</div>
                    <div class="power-up-slot" id="slot2">-</div>
                    <div class="power-up-slot" id="slot3">-</div>
                </div>
            </div>

            <div class="controls">
                <h3>ğŸ® æ“ä½œæŒ‡å—</h3>
                <div class="control-group">
                    <div class="control-title">ğŸ•¹ï¸ ç§»åŠ¨æ§åˆ¶</div>
                    <div class="control-item">
                        <span class="key">â†</span> <span class="key">â†’</span>
                        <span class="action">å·¦å³ç§»åŠ¨çƒæ‹</span>
                    </div>
                    <div class="control-item">
                        <span class="key">A</span> <span class="key">D</span>
                        <span class="action">å¤‡ç”¨ç§»åŠ¨é”®</span>
                    </div>
                </div>
                <div class="control-group">
                    <div class="control-title">âš¡ æ¸¸æˆæ§åˆ¶</div>
                    <div class="control-item">
                        <span class="key">ç©ºæ ¼</span>
                        <span class="action">å‘å°„çƒ/æš‚åœ</span>
                    </div>
                    <div class="control-item">
                        <span class="key">P</span>
                        <span class="action">æš‚åœ/ç»§ç»­</span>
                    </div>
                </div>
                <div class="control-group">
                    <div class="control-title">ğŸ’ é“å…·è¯´æ˜</div>
                    <div class="power-up-grid">
                        <div class="power-up-item">ğŸ”µ åŠ é•¿çƒæ‹</div>
                        <div class="power-up-item">ğŸŸ¢ å‡é€Ÿçƒ</div>
                        <div class="power-up-item">ğŸŸ¡ å¤šçƒåˆ†è£‚</div>
                        <div class="power-up-item">ğŸ”´ ç²˜æ€§çƒæ‹</div>
                        <div class="power-up-item">ğŸŸ  ç©¿é€çƒ</div>
                    </div>
                </div>
                <div class="control-group">
                    <div class="control-title">ğŸ¯ æ¸¸æˆç›®æ ‡</div>
                    <div class="game-tips">
                        <div>â€¢ æ¶ˆé™¤æ‰€æœ‰ç –å—è¿‡å…³</div>
                        <div>â€¢ è¿ç»­å‡»ç¢è·å¾—è¿å‡»åŠ åˆ†</div>
                        <div>â€¢ æ”¶é›†é“å…·å¢å¼ºèƒ½åŠ›</div>
                        <div>â€¢ é¿å…çƒæ‰è½</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // æ¸¸æˆå¸¸é‡
        const PADDLE_WIDTH = 120;
        const PADDLE_HEIGHT = 15;
        const BALL_RADIUS = 8;
        const BRICK_WIDTH = 60;
        const BRICK_HEIGHT = 20;
        const BRICK_PADDING = 2;
        const BRICK_OFFSET_TOP = 60;
        const BRICK_OFFSET_LEFT = 60;

        // æ¸¸æˆçŠ¶æ€
        let paddle = null;
        let balls = [];
        let bricks = [];
        let powerUps = [];
        let particles = [];
        let score = 0;
        let highScore = localStorage.getItem('breakoutHighScore') || 0;
        let level = 1;
        let lives = 3;
        let gameRunning = true;
        let isPaused = false;
        let isLaunched = false;
        let keys = {};
        let combo = 0;
        let maxCombo = 0;
        let totalBricksDestroyed = 0;

        // é“å…·æ•ˆæœ
        let paddleWidth = PADDLE_WIDTH;
        let ballSpeedMultiplier = 1;
        let stickyPaddle = false;
        let penetratingBall = false;
        let activePowerUps = [];

        // çƒæ‹ç±»
        class Paddle {
            constructor() {
                this.width = paddleWidth;
                this.height = PADDLE_HEIGHT;
                this.x = canvas.width / 2 - this.width / 2;
                this.y = canvas.height - this.height - 20;
                this.speed = 8;
            }

            update() {
                if (keys['ArrowLeft'] || keys['a'] || keys['A']) {
                    this.x = Math.max(0, this.x - this.speed);
                }
                if (keys['ArrowRight'] || keys['d'] || keys['D']) {
                    this.x = Math.min(canvas.width - this.width, this.x + this.speed);
                }
            }

            draw() {
                // çƒæ‹ä¸»ä½“
                const gradient = ctx.createLinearGradient(this.x, this.y, this.x, this.y + this.height);
                gradient.addColorStop(0, '#4ecdc4');
                gradient.addColorStop(1, '#45b7d1');

                ctx.fillStyle = gradient;
                ctx.fillRect(this.x, this.y, this.width, this.height);

                // çƒæ‹é«˜å…‰
                ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
                ctx.fillRect(this.x, this.y, this.width, 3);

                // ç²˜æ€§çƒæ‹æ•ˆæœ
                if (stickyPaddle) {
                    ctx.strokeStyle = 'rgba(255, 255, 0, 0.8)';
                    ctx.lineWidth = 3;
                    ctx.strokeRect(this.x - 2, this.y - 2, this.width + 4, this.height + 4);
                }
            }
        }

        // çƒç±»
        class Ball {
            constructor(x, y, dx = 0, dy = 0) {
                this.x = x;
                this.y = y;
                this.dx = dx;
                this.dy = dy;
                this.radius = BALL_RADIUS;
                this.speed = 5 * ballSpeedMultiplier;
                this.attached = true;
                this.penetrating = penetratingBall;
            }

            update() {
                if (!this.attached) {
                    this.x += this.dx * this.speed;
                    this.y += this.dy * this.speed;

                    // å¢™å£ç¢°æ’
                    if (this.x - this.radius <= 0 || this.x + this.radius >= canvas.width) {
                        this.dx = -this.dx;
                        createParticles(this.x, this.y, '#ffffff');
                    }

                    if (this.y - this.radius <= 0) {
                        this.dy = -this.dy;
                        createParticles(this.x, this.y, '#ffffff');
                    }

                    // çƒæ‹ç¢°æ’
                    if (this.y + this.radius >= paddle.y &&
                        this.y - this.radius <= paddle.y + paddle.height &&
                        this.x >= paddle.x &&
                        this.x <= paddle.x + paddle.width) {

                        this.dy = -Math.abs(this.dy);

                        // æ ¹æ®å‡»çƒä½ç½®è°ƒæ•´è§’åº¦
                        const hitPos = (this.x - paddle.x) / paddle.width;
                        this.dx = (hitPos - 0.5) * 2;

                        if (stickyPaddle) {
                            this.attached = true;
                        }

                        createParticles(this.x, this.y, '#4ecdc4');
                    }

                    // åº•éƒ¨è¾¹ç•Œ
                    if (this.y > canvas.height) {
                        return false;
                    }
                }

                return true;
            }

            draw() {
                // çƒçš„ä¸»ä½“
                const gradient = ctx.createRadialGradient(this.x - 3, this.y - 3, 0, this.x, this.y, this.radius);
                gradient.addColorStop(0, '#ffffff');
                gradient.addColorStop(0.7, '#ffff00');
                gradient.addColorStop(1, '#ff6b6b');

                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();

                // ç©¿é€çƒæ•ˆæœ
                if (this.penetrating) {
                    ctx.strokeStyle = '#ff4444';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }

                // çƒçš„è½¨è¿¹
                ctx.shadowColor = '#ffff00';
                ctx.shadowBlur = 10;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
            }

            launch() {
                if (this.attached) {
                    this.attached = false;
                    this.dx = (Math.random() - 0.5) * 2;
                    this.dy = -1;
                    this.speed = 5 * ballSpeedMultiplier;
                }
            }
        }

        // ç –å—ç±»
        class Brick {
            constructor(x, y, color, hits = 1, points = 10) {
                this.x = x;
                this.y = y;
                this.width = BRICK_WIDTH;
                this.height = BRICK_HEIGHT;
                this.color = color;
                this.hits = hits;
                this.maxHits = hits;
                this.points = points;
                this.active = true;
            }

            hit() {
                this.hits--;
                if (this.hits <= 0) {
                    this.active = false;
                    this.destroy();
                    return this.points;
                }
                return 0;
            }

            destroy() {
                createParticles(this.x + this.width / 2, this.y + this.height / 2, this.color);

                // æ‰è½é“å…·
                if (Math.random() < 0.2) {
                    const types = ['expand', 'slow', 'multiball', 'sticky', 'penetrate'];
                    const type = types[Math.floor(Math.random() * types.length)];
                    powerUps.push(new PowerUp(this.x + this.width / 2, this.y + this.height / 2, type));
                }
            }

            draw() {
                if (!this.active) return;

                // ç –å—ä¸»ä½“
                const alpha = this.hits / this.maxHits;
                ctx.fillStyle = this.color;
                ctx.globalAlpha = alpha;
                ctx.fillRect(this.x, this.y, this.width, this.height);

                // ç –å—è¾¹æ¡†
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.lineWidth = 1;
                ctx.strokeRect(this.x, this.y, this.width, this.height);

                // é«˜å…‰æ•ˆæœ
                ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.fillRect(this.x, this.y, this.width, 3);

                ctx.globalAlpha = 1;
            }
        }

        // é“å…·ç±»
        class PowerUp {
            constructor(x, y, type) {
                this.x = x;
                this.y = y;
                this.type = type;
                this.width = 20;
                this.height = 20;
                this.speed = 2;
                this.active = true;
            }

            update() {
                this.y += this.speed;
                if (this.y > canvas.height) {
                    this.active = false;
                }
            }

            draw() {
                const colors = {
                    'expand': '#4169e1',
                    'slow': '#32cd32',
                    'multiball': '#ff69b4',
                    'sticky': '#ffd700',
                    'penetrate': '#ff4500'
                };

                const icons = {
                    'expand': 'â†”',
                    'slow': 'â±',
                    'multiball': 'â—â—',
                    'sticky': 'ğŸ§¤',
                    'penetrate': 'ğŸ’¥'
                };

                ctx.fillStyle = colors[this.type];
                ctx.fillRect(this.x, this.y, this.width, this.height);

                ctx.fillStyle = '#ffffff';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(icons[this.type], this.x + this.width / 2, this.y + this.height / 2 + 4);
            }

            apply() {
                switch (this.type) {
                    case 'expand':
                        paddleWidth = Math.min(paddleWidth + 20, 200);
                        paddle.width = paddleWidth;
                        addPowerUp('åŠ é•¿çƒæ‹');
                        break;
                    case 'slow':
                        ballSpeedMultiplier = Math.max(ballSpeedMultiplier * 0.8, 0.5);
                        addPowerUp('å‡é€Ÿçƒ');
                        updateBallSpeed();
                        break;
                    case 'multiball':
                        const currentBalls = balls.filter(ball => !ball.attached);
                        if (currentBalls.length > 0) {
                            for (let i = 0; i < 2; i++) {
                                const ball = currentBalls[0];
                                balls.push(new Ball(ball.x, ball.y, ball.dx, ball.dy));
                                balls[balls.length - 1].attached = false;
                            }
                        }
                        addPowerUp('å¤šçƒ');
                        break;
                    case 'sticky':
                        stickyPaddle = true;
                        addPowerUp('ç²˜æ€§çƒæ‹');
                        break;
                    case 'penetrate':
                        penetratingBall = true;
                        balls.forEach(ball => ball.penetrating = true);
                        addPowerUp('ç©¿é€çƒ');
                        break;
                }
            }
        }

        // ç²’å­æ•ˆæœç±»
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 8;
                this.vy = (Math.random() - 0.5) * 8;
                this.color = color;
                this.life = 30;
                this.maxLife = 30;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.2; // é‡åŠ›
                this.life--;
            }

            draw() {
                const alpha = this.life / this.maxLife;
                ctx.globalAlpha = alpha;
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x - 2, this.y - 2, 4, 4);
                ctx.globalAlpha = 1;
            }
        }

        // åˆ›å»ºç²’å­æ•ˆæœ
        function createParticles(x, y, color) {
            for (let i = 0; i < 10; i++) {
                particles.push(new Particle(x, y, color));
            }
        }

        // åˆå§‹åŒ–ç –å—
        function initBricks() {
            bricks = [];
            const rows = 5 + Math.floor(level / 2);
            const cols = 8;

            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    const x = c * (BRICK_WIDTH + BRICK_PADDING) + BRICK_OFFSET_LEFT;
                    const y = r * (BRICK_HEIGHT + BRICK_PADDING) + BRICK_OFFSET_TOP;

                    const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#dda0dd'];
                    const color = colors[r % colors.length];

                    const hits = Math.floor(r / 2) + 1;
                    const points = (r + 1) * 10;

                    bricks.push(new Brick(x, y, color, hits, points));
                }
            }
        }

        // ç¢°æ’æ£€æµ‹
        function checkBallBrickCollision(ball, brick) {
            return ball.x + ball.radius >= brick.x &&
                   ball.x - ball.radius <= brick.x + brick.width &&
                   ball.y + ball.radius >= brick.y &&
                   ball.y - ball.radius <= brick.y + brick.height;
        }

        // æ·»åŠ é“å…·æ•ˆæœ
        function addPowerUp(name) {
            activePowerUps.push({
                name: name,
                time: Date.now()
            });

            if (activePowerUps.length > 3) {
                activePowerUps.shift();
            }

            updatePowerUpDisplay();
            showPowerUp(name);
        }

        // æ›´æ–°é“å…·æ˜¾ç¤º
        function updatePowerUpDisplay() {
            for (let i = 0; i < 3; i++) {
                const slot = document.getElementById(`slot${i + 1}`);
                if (activePowerUps[i]) {
                    slot.textContent = activePowerUps[i].name.substring(0, 2);
                    slot.style.background = 'rgba(0, 255, 0, 0.3)';
                } else {
                    slot.textContent = '-';
                    slot.style.background = 'rgba(255, 255, 255, 0.1)';
                }
            }
        }

        // æ˜¾ç¤ºé“å…·æç¤º
        function showPowerUp(text) {
            const powerUpElement = document.getElementById('powerUpIndicator');
            powerUpElement.textContent = text;
            powerUpElement.style.display = 'block';
            setTimeout(() => {
                powerUpElement.style.display = 'none';
            }, 3000);
        }

        // æ˜¾ç¤ºè¿å‡»
        function showCombo(comboCount) {
            const comboElement = document.getElementById('comboIndicator');
            comboElement.textContent = `${comboCount}è¿å‡»!`;
            comboElement.style.display = 'block';
            setTimeout(() => {
                comboElement.style.display = 'none';
            }, 2000);
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            document.getElementById('score').textContent = score;
            document.getElementById('highScore').textContent = highScore;
            document.getElementById('level').textContent = level;
            document.getElementById('bricksLeft').textContent = bricks.filter(b => b.active).length;
            document.getElementById('currentCombo').textContent = combo;
        }

        // æ›´æ–°ç”Ÿå‘½å€¼æ˜¾ç¤º
        function updateLivesDisplay() {
            let hearts = '';
            for (let i = 0; i < lives; i++) {
                hearts += 'â¤ï¸';
            }
            document.getElementById('lives').textContent = hearts;
        }

        // æ›´æ–°çƒé€Ÿæ˜¾ç¤º
        function updateBallSpeed() {
            const speedElement = document.getElementById('ballSpeed');
            if (ballSpeedMultiplier <= 0.6) {
                speedElement.textContent = 'æ…¢é€Ÿ';
            } else if (ballSpeedMultiplier <= 1) {
                speedElement.textContent = 'æ­£å¸¸';
            } else {
                speedElement.textContent = 'å¿«é€Ÿ';
            }
        }

        // ä¸‹ä¸€å…³
        function nextLevel() {
            level++;
            ballSpeedMultiplier = Math.min(ballSpeedMultiplier + 0.1, 2);
            combo = 0;
            score += level * 500;

            // é‡ç½®é“å…·æ•ˆæœ
            paddleWidth = PADDLE_WIDTH;
            ballSpeedMultiplier = 1 + (level - 1) * 0.1;
            stickyPaddle = false;
            penetratingBall = false;
            activePowerUps = [];

            initBricks();
            resetBall();
            updateDisplay();
            updatePowerUpDisplay();
            updateBallSpeed();
        }

        // é‡ç½®çƒ
        function resetBall() {
            balls = [new Ball(paddle.x + paddle.width / 2, paddle.y - BALL_RADIUS - 5)];
        }

        // æ¸¸æˆç»“æŸ
        function gameOver() {
            gameRunning = false;

            if (score > highScore) {
                highScore = score;
                localStorage.setItem('breakoutHighScore', highScore);
            }

            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalLevel').textContent = level;
            document.getElementById('finalBricks').textContent = totalBricksDestroyed;
            document.getElementById('finalCombo').textContent = maxCombo;
            document.getElementById('gameOverTitle').textContent = lives <= 0 ? 'æ¸¸æˆç»“æŸ!' : 'æ­å–œé€šå…³!';
            document.getElementById('gameOver').style.display = 'block';
        }

        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            paddle = new Paddle();
            balls = [];
            bricks = [];
            powerUps = [];
            particles = [];
            score = 0;
            level = 1;
            lives = 3;
            combo = 0;
            maxCombo = 0;
            totalBricksDestroyed = 0;
            gameRunning = true;
            isPaused = false;
            isLaunched = false;
            ballSpeedMultiplier = 1;
            paddleWidth = PADDLE_WIDTH;
            stickyPaddle = false;
            penetratingBall = false;
            activePowerUps = [];

            document.getElementById('gameOver').style.display = 'none';
            initBricks();
            resetBall();
            updateDisplay();
            updateLivesDisplay();
            updatePowerUpDisplay();
            updateBallSpeed();
            gameLoop(); // é‡æ–°å¯åŠ¨æ¸¸æˆå¾ªç¯
        }

        // æš‚åœ/ç»§ç»­
        function togglePause() {
            if (gameRunning) {
                isPaused = !isPaused;
                document.querySelector('.pause-btn').textContent = isPaused ? 'ç»§ç»­' : 'æš‚åœ';
            }
        }

        // é”®ç›˜äº‹ä»¶
        document.addEventListener('keydown', (e) => {
            // é˜²æ­¢æ–¹å‘é”®å’Œæ¸¸æˆæ§åˆ¶é”®çš„é»˜è®¤è¡Œä¸º
            if (['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', ' '].includes(e.key)) {
                e.preventDefault();
            }
            keys[e.key] = true;

            if (e.key === ' ') {
                if (!gameRunning) {
                    restartGame();
                } else if (!isLaunched) {
                    balls.forEach(ball => ball.launch());
                    isLaunched = true;
                } else {
                    togglePause();
                }
            }

            if (e.key === 'p' || e.key === 'P') {
                togglePause();
            }
        });

        document.addEventListener('keyup', (e) => {
            // é˜²æ­¢æ¸¸æˆæ§åˆ¶é”®çš„é»˜è®¤è¡Œä¸º
            if (['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', ' '].includes(e.key)) {
                e.preventDefault();
            }
            keys[e.key] = false;
        });

        // ç¡®ä¿ç”»å¸ƒå¯ä»¥æ¥æ”¶ç„¦ç‚¹
        canvas.setAttribute('tabindex', '0');
        canvas.focus();

        // æ¸¸æˆä¸»å¾ªç¯
        function gameLoop() {
            if (!gameRunning) return;

            if (!isPaused) {
                // æ¸…ç©ºç”»å¸ƒ
                ctx.fillStyle = 'rgba(0, 17, 34, 0.1)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // æ›´æ–°å’Œç»˜åˆ¶çƒæ‹
                paddle.update();
                paddle.draw();

                // æ›´æ–°å’Œç»˜åˆ¶ç –å—
                let activeBricks = 0;
                bricks.forEach(brick => {
                    if (brick.active) {
                        activeBricks++;
                        brick.draw();
                    }
                });

                // æ›´æ–°å’Œç»˜åˆ¶çƒ
                balls = balls.filter(ball => {
                    const stillActive = ball.update();

                    if (!stillActive) {
                        if (balls.length === 1) {
                            lives--;
                            updateLivesDisplay();
                            combo = 0;

                            if (lives <= 0) {
                                gameOver();
                                return false;
                            }

                            resetBall();
                            isLaunched = false;
                        }
                        return false;
                    }

                    // çƒå’Œç –å—ç¢°æ’æ£€æµ‹
                    if (!ball.attached) {
                        bricks.forEach(brick => {
                            if (brick.active && checkBallBrickCollision(ball, brick)) {
                                if (!ball.penetrating) {
                                    // è®¡ç®—åå¼¹æ–¹å‘
                                    const ballCenterX = ball.x;
                                    const ballCenterY = ball.y;
                                    const brickCenterX = brick.x + brick.width / 2;
                                    const brickCenterY = brick.y + brick.height / 2;

                                    const dx = ballCenterX - brickCenterX;
                                    const dy = ballCenterY - brickCenterY;

                                    if (Math.abs(dx) > Math.abs(dy)) {
                                        ball.dx = -ball.dx;
                                    } else {
                                        ball.dy = -ball.dy;
                                    }
                                }

                                const points = brick.hit();
                                if (points > 0) {
                                    score += points;
                                    totalBricksDestroyed++;
                                    combo++;
                                    maxCombo = Math.max(maxCombo, combo);

                                    if (combo > 1) {
                                        showCombo(combo);
                                        score += combo * 5;
                                    }
                                }
                            }
                        });
                    }

                    ball.draw();
                    return true;
                });

                // æ£€æŸ¥å…³å¡å®Œæˆ
                if (activeBricks === 0) {
                    if (level < 10) {
                        nextLevel();
                    } else {
                        gameOver();
                    }
                }

                // æ›´æ–°å’Œç»˜åˆ¶é“å…·
                powerUps = powerUps.filter(powerUp => {
                    powerUp.update();

                    // é“å…·å’Œçƒæ‹ç¢°æ’æ£€æµ‹
                    if (powerUp.x < paddle.x + paddle.width &&
                        powerUp.x + powerUp.width > paddle.x &&
                        powerUp.y < paddle.y + paddle.height &&
                        powerUp.y + powerUp.height > paddle.y) {
                        powerUp.apply();
                        return false;
                    }

                    powerUp.draw();
                    return powerUp.active;
                });

                // æ›´æ–°å’Œç»˜åˆ¶ç²’å­
                particles = particles.filter(particle => {
                    particle.update();
                    particle.draw();
                    return particle.life > 0;
                });

                // å¦‚æœçƒæœªå‘å°„ï¼Œè·Ÿéšçƒæ‹
                if (!isLaunched && balls.length > 0) {
                    balls[0].x = paddle.x + paddle.width / 2;
                    balls[0].y = paddle.y - BALL_RADIUS - 5;
                }

                updateDisplay();
            }

            requestAnimationFrame(gameLoop);
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            paddle = new Paddle();
            initBricks();
            resetBall();
            updateDisplay();
            updateLivesDisplay();
            updatePowerUpDisplay();
            updateBallSpeed();
            gameLoop();
        }

        // å¯åŠ¨æ¸¸æˆ
        initGame();
    </script>
</body>
</html>